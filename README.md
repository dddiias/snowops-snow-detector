# Snow Detector

Сервис анализирует видеопоток по RTSP, ищет грузовики моделью YOLOv8n и оценивает, насколько их кузов заполнен снегом. При проходе грузовика через центральную зону кадра делает снапшот, подписывает результат на кадре и выводит JSON с расчётом.

## Требования
- Python 3.10+.
- Windows/Linux/macOS с установленным FFmpeg в PATH желательно для корректной работы OpenCV с RTSP.
- Вес модели `yolov8n.pt` должен лежать рядом с `main.py` (уже присутствует).

## Установка
```bash
python -m venv .venv
.\.venv\Scripts\activate   # Linux/macOS: source .venv/bin/activate
pip install -r requirements.txt
```

## Настройка
Все основные параметры задаются в `main.py`:
- `VIDEO_SOURCE_URL` — RTSP URL камеры (замените на свой, при необходимости добавьте логин/пароль).
- `YOLO_MODEL_PATH` — путь к весам YOLOv8n.
- `TRUCK_CLASS_ID` — ID класса из COCO (7 соответствует truck).
- `CONFIDENCE_THRESHOLD` — порог детекции.
- `CENTER_ZONE_START_X` / `CENTER_ZONE_END_X` — границы центральной зоны по ширине кадра (доли от 0 до 1).
- `SNAPSHOT_DIR` — папка для сохранения кадров.
- `HISTORY_LENGTH`, `MAX_HISTORY` — длина истории для определения направления движения.

## Запуск
```bash
python main.py
```
Окно с потоком откроется через OpenCV. Выход — по клавише `q`.

## Как это работает
- Поток читается из `VIDEO_SOURCE_URL`.
- YOLO детектирует грузовики (берётся первый найденный бокс).
- По траектории центра бокса вычисляется направление движения.
- Если грузовик движется вправо, входит в центральную зону и ещё не обработан — вырезается область кузова, в HSV считается доля «белых» пикселей сверху вниз (оценка объёма снега), результат наносится на кадр и сохраняется в `snapshots/capture_<timestamp>.jpg`.
- В консоль печатается JSON с направлением и долей заполнения.

## Известные особенности
- Текст в консоли и ключи JSON сейчас отображаются «кракозябрами» из-за неверной кодировки исходных строк — при необходимости замените строки на UTF-8.
- Обработка ориентирована на один грузовик за раз: берётся первый бокс от YOLO. Для нескольких объектов логику выбора/трекера нужно расширить.
